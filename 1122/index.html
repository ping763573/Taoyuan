<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>巴菲特價值投資儀表板 v1.0.2</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar to match the feel */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Smooth transitions */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 transition-all duration-300 min-h-screen p-2 md:p-6" id="app-body">

    <!-- Header -->
    <header class="bg-white rounded-2xl shadow-sm p-4 mb-6 flex justify-between items-center border-l-4 border-emerald-500">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="trending-up" class="text-emerald-600"></i>
                巴菲特價值投資儀表板
            </h1>
            <p class="text-slate-500 text-sm mt-1">
                整合實踐指南與視覺化教學平台 | Ver 1.0.2 (HTML版)
            </p>
        </div>
        <button onclick="toggleFullScreen()" class="p-2 rounded-full hover:bg-slate-100 transition-colors text-slate-600" title="全螢幕模式">
            <i data-lucide="maximize" id="fullscreen-icon"></i>
        </button>
    </header>

    <!-- Navigation -->
    <nav class="flex overflow-x-auto gap-2 mb-6 pb-2 no-scrollbar">
        <button onclick="switchTab('home')" class="nav-btn flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap bg-emerald-600 text-white shadow-emerald-200 ring-2 ring-emerald-100 shadow-sm" id="btn-home">
            <i data-lucide="home" class="w-4 h-4"></i> 首頁
        </button>
        <button onclick="switchTab('calculator')" class="nav-btn flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap bg-white text-slate-600 hover:bg-emerald-50 border border-transparent hover:border-emerald-100 shadow-sm" id="btn-calculator">
            <i data-lucide="calculator" class="w-4 h-4"></i> 估價計算機
        </button>
        <button onclick="switchTab('checklist')" class="nav-btn flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap bg-white text-slate-600 hover:bg-emerald-50 border border-transparent hover:border-emerald-100 shadow-sm" id="btn-checklist">
            <i data-lucide="check-circle" class="w-4 h-4"></i> 體質檢查清單
        </button>
        <button onclick="switchTab('knowledge')" class="nav-btn flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap bg-white text-slate-600 hover:bg-emerald-50 border border-transparent hover:border-emerald-100 shadow-sm" id="btn-knowledge">
            <i data-lucide="book-open" class="w-4 h-4"></i> 投資知識百科
        </button>
        <button onclick="switchTab('concepts')" class="nav-btn flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all whitespace-nowrap bg-white text-slate-600 hover:bg-emerald-50 border border-transparent hover:border-emerald-100 shadow-sm" id="btn-concepts">
            <i data-lucide="lightbulb" class="w-4 h-4"></i> 圖解觀念
        </button>
    </nav>

    <!-- Main Content -->
    <main class="min-h-[600px]">
        
        <!-- 1. Home View -->
        <div id="view-home" class="view-section fade-in">
            <div class="space-y-8">
                <section class="bg-white rounded-2xl shadow-sm p-8 border-b-4 border-emerald-500">
                    <h1 class="text-3xl font-bold text-slate-800 mb-4">歡迎來到價值投資世界</h1>
                    <p class="text-xl text-slate-500 leading-relaxed">
                        遵循巴菲特和班傑明·葛拉漢的投資智慧，從根本理解股票價值與估價方法。
                    </p>
                </section>

                <section class="bg-emerald-50 rounded-2xl p-8 border-l-4 border-emerald-600">
                    <h2 class="text-xl font-bold text-emerald-800 mb-3">投資的核心信念</h2>
                    <p class="text-lg text-emerald-900 font-medium mb-2">
                        「股票不只是交易代碼，而是企業的部分所有權。」
                    </p>
                    <p class="text-emerald-700">
                        成功投資源於對企業基本面的深刻理解，而非預測市場短期波動。專注於企業的長期盈利能力和可持續發展性。
                    </p>
                </section>

                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Info Cards -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow border border-slate-100">
                        <div class="text-4xl mb-4 bg-slate-50 w-16 h-16 rounded-xl flex items-center justify-center">🎯</div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">定性分析</h3>
                        <p class="text-slate-600 text-sm leading-relaxed">如何辨識擁有持久競爭優勢的「偉大企業」？尋找護城河。</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow border border-slate-100">
                        <div class="text-4xl mb-4 bg-slate-50 w-16 h-16 rounded-xl flex items-center justify-center">📊</div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">定量分析</h3>
                        <p class="text-slate-600 text-sm leading-relaxed">用財務數據衡量企業的卓越品質與盈利能力。驗證品質。</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow border border-slate-100">
                        <div class="text-4xl mb-4 bg-slate-50 w-16 h-16 rounded-xl flex items-center justify-center">💰</div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">企業估價</h3>
                        <p class="text-slate-600 text-sm leading-relaxed">判斷合理價格並確保安全邊際。計算價值。</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-shadow border border-slate-100">
                        <div class="text-4xl mb-4 bg-slate-50 w-16 h-16 rounded-xl flex items-center justify-center">🧠</div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">投資紀律</h3>
                        <p class="text-slate-600 text-sm leading-relaxed">在市場波動中保持理性心態並贏得最終賽局。實踐心法。</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Valuation Calculator -->
        <div id="view-calculator" class="view-section hidden fade-in">
            <div class="grid md:grid-cols-12 gap-6">
                <!-- Input Panel -->
                <div class="md:col-span-5 bg-white p-6 rounded-2xl shadow-sm h-fit border border-slate-100">
                    <h2 class="text-xl font-bold mb-4 text-slate-700 flex items-center gap-2">
                        <i data-lucide="calculator" class="text-emerald-500"></i> 參數設定
                    </h2>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-600 mb-2">選擇股票類型</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setStockType('asset')" class="type-btn p-2 rounded-lg text-sm border transition-all flex flex-col items-center justify-center text-center border-emerald-500 bg-emerald-50 text-emerald-700 font-bold ring-1 ring-emerald-500" id="type-asset">
                                <span>資產股</span>
                                <span class="text-xs opacity-70 font-normal mt-1">P/B 估價</span>
                            </button>
                            <button onclick="setStockType('dividend')" class="type-btn p-2 rounded-lg text-sm border transition-all flex flex-col items-center justify-center text-center border-slate-200 text-slate-500 hover:bg-slate-50" id="type-dividend">
                                <span>股息股</span>
                                <span class="text-xs opacity-70 font-normal mt-1">殖利率 估價</span>
                            </button>
                            <button onclick="setStockType('growth')" class="type-btn p-2 rounded-lg text-sm border transition-all flex flex-col items-center justify-center text-center border-slate-200 text-slate-500 hover:bg-slate-50" id="type-growth">
                                <span>成長股</span>
                                <span class="text-xs opacity-70 font-normal mt-1">PEG 估價</span>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">目前股價 (Price)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                                <input type="number" id="input-price" class="w-full pl-8 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="例如: 100">
                            </div>
                        </div>

                        <!-- Dynamic Inputs -->
                        <div id="input-group-asset">
                            <label class="block text-sm font-medium text-slate-700 mb-1">每股帳面價值 (BVPS)</label>
                            <input type="number" id="input-bvps" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="適合銀行、營建、水泥股">
                            <p class="text-xs text-slate-500 mt-1">公式：合理價 = 帳面價值 × 0.8</p>
                        </div>

                        <div id="input-group-dividend" class="hidden">
                            <label class="block text-sm font-medium text-slate-700 mb-1">現金股利 (Dividend)</label>
                            <input type="number" id="input-dividend" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="適合民生消費、公用事業">
                            <p class="text-xs text-slate-500 mt-1">公式：合理價 = 股利 ÷ 4%</p>
                        </div>

                        <div id="input-group-growth" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">每股盈餘 (EPS)</label>
                                <input type="number" id="input-eps" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="過去12個月獲利">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">預估成長率 (Growth Rate %)</label>
                                <input type="number" id="input-growth" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="例如 15 (代表15%)">
                            </div>
                            <p class="text-xs text-slate-500">公式：合理價 = EPS × 成長率</p>
                        </div>

                        <button onclick="calculateValuation()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-emerald-200 transition-all mt-4 flex justify-center items-center gap-2">
                            <i data-lucide="calculator" class="w-5 h-5"></i> 計算合理價值
                        </button>
                    </div>
                </div>

                <!-- Result Panel -->
                <div class="md:col-span-7 space-y-6">
                    <div id="result-container" class="hidden bg-white p-6 rounded-2xl shadow-sm animate-fade-in border-t-4 border-emerald-500 border-l border-r border-b border-slate-100">
                        <h3 class="text-lg font-semibold text-slate-600 mb-4">估值分析結果</h3>
                        
                        <div class="flex flex-col md:flex-row gap-8 items-center mb-8">
                            <div class="text-center md:text-left">
                                <p class="text-sm text-slate-500 mb-1">計算公式</p>
                                <p id="result-formula" class="text-sm font-mono text-slate-700 bg-slate-100 px-2 py-1 rounded"></p>
                            </div>
                            <div class="flex-1 w-full">
                                <div class="flex justify-between items-end mb-2">
                                    <span id="result-fair-value" class="text-3xl font-bold text-slate-800"></span>
                                    <span id="result-badge" class="px-3 py-1 rounded-full text-sm font-bold"></span>
                                </div>
                                <div class="h-4 bg-slate-100 rounded-full overflow-hidden relative">
                                    <div id="result-marker" class="absolute top-0 bottom-0 w-1 bg-black z-10 transition-all duration-1000"></div>
                                    <div class="h-full w-full bg-gradient-to-r from-emerald-200 via-emerald-400 to-rose-300 opacity-70"></div>
                                </div>
                                <div class="flex justify-between text-xs text-slate-400 mt-1">
                                    <span>$0</span>
                                    <span id="result-current-price-label"></span>
                                    <span id="result-max-scale"></span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <p class="text-slate-500 text-sm mb-1">安全邊際 (MOS)</p>
                                <p id="result-mos" class="text-2xl font-bold"></p>
                                <p class="text-xs text-slate-400 mt-1">正值代表低於合理價的幅度</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <p class="text-slate-500 text-sm mb-1">潛在漲幅 (Upside)</p>
                                <p id="result-upside" class="text-2xl font-bold"></p>
                                <p class="text-xs text-slate-400 mt-1">回歸合理價的空間</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-blue-50 text-blue-800 rounded-xl text-sm flex gap-3 items-start">
                            <i data-lucide="info" class="shrink-0 mt-0.5 w-4 h-4"></i>
                            <div>
                                <span class="font-bold block mb-1">投資建議提示：</span>
                                <span id="result-tip"></span>
                            </div>
                        </div>
                    </div>

                    <div id="result-placeholder" class="h-full flex flex-col items-center justify-center text-slate-400 p-12 border-2 border-dashed border-slate-200 rounded-2xl bg-slate-50">
                        <i data-lucide="bar-chart-3" class="w-12 h-12 mb-4 opacity-50"></i>
                        <p>請在左側輸入數據以開始估價</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Quality Checklist -->
        <div id="view-checklist" class="view-section hidden fade-in">
            <div class="grid md:grid-cols-12 gap-6">
                <div class="md:col-span-8">
                    <div class="bg-white rounded-2xl shadow-sm p-6 border border-slate-100">
                        <h2 class="text-xl font-bold mb-6 text-slate-700 flex items-center gap-2">
                            <i data-lucide="activity" class="text-emerald-500"></i>
                            優質企業體質掃描
                        </h2>
                        <div id="checklist-items" class="space-y-3">
                            <!-- Checklist items will be generated by JS -->
                        </div>
                    </div>
                </div>
                
                <div class="md:col-span-4">
                    <div class="bg-white rounded-2xl shadow-sm p-6 sticky top-6 border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-700 mb-4">綜合評分</h3>
                        <div class="relative w-48 h-48 mx-auto mb-6">
                            <div id="score-circle" class="w-full h-full rounded-full flex items-center justify-center shadow-inner"
                                 style="background: conic-gradient(#f1f5f9 0deg, #f1f5f9 360deg)">
                                <div class="w-40 h-40 bg-white rounded-full flex flex-col items-center justify-center shadow-sm">
                                    <span id="score-number" class="text-4xl font-bold text-emerald-600">0</span>
                                    <span class="text-sm text-slate-400">/ 7 項符合</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <p id="score-grade" class="text-lg font-medium mb-2">🧱 觀察名單</p>
                            <p id="score-desc" class="text-sm text-slate-500">基本面存在較多疑慮，建議保守觀望。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Knowledge Base -->
        <div id="view-knowledge" class="view-section hidden fade-in">
            <div class="grid md:grid-cols-12 gap-6">
                <!-- Sidebar Nav -->
                <div class="md:col-span-3 space-y-2">
                    <div class="bg-white rounded-2xl shadow-sm p-4 sticky top-4">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3 px-2">目錄</h3>
                        <button onclick="switchKB('valuation')" class="kb-nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 transition-colors bg-emerald-50 text-emerald-700 font-bold" id="kb-nav-valuation">
                            <i data-lucide="calculator" class="w-4 h-4"></i> 估價方法論
                        </button>
                        <button onclick="switchKB('moat')" class="kb-nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 transition-colors text-slate-600 hover:bg-slate-50" id="kb-nav-moat">
                            <i data-lucide="shield" class="w-4 h-4"></i> 經濟護城河
                        </button>
                        <button onclick="switchKB('framework')" class="kb-nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 transition-colors text-slate-600 hover:bg-slate-50" id="kb-nav-framework">
                            <i data-lucide="layers" class="w-4 h-4"></i> 投資框架
                        </button>
                        <button onclick="switchKB('dcf')" class="kb-nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 transition-colors text-slate-600 hover:bg-slate-50" id="kb-nav-dcf">
                            <i data-lucide="activity" class="w-4 h-4"></i> DCF 模型
                        </button>
                        <button onclick="switchKB('psychology')" class="kb-nav-btn w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 transition-colors text-slate-600 hover:bg-slate-50" id="kb-nav-psychology">
                            <i data-lucide="brain" class="w-4 h-4"></i> 市場心法
                        </button>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="md:col-span-9 space-y-8">
                    
                    <!-- KB: Valuation -->
                    <div id="kb-content-valuation" class="kb-content block space-y-6 fade-in">
                        <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-emerald-500 pl-4">股票三大類型與估價方法</h2>
                        <p class="text-slate-600">不同類型的股票需要採用不同的估價方法。了解每種方法的核心邏輯。</p>
                        
                        <div class="grid gap-6">
                            <!-- Cards generated via HTML for simplicity -->
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <div class="flex items-center gap-2 mb-2"><div class="h-2 w-2 rounded-full bg-emerald-500"></div><h3 class="text-lg font-bold text-slate-800">1. 資產股 (Asset Stock)</h3></div>
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 block ml-4">重資產企業：銀行、礦業、房地產</span>
                                <div class="ml-4">
                                    <p class="mb-4 text-slate-600">專注於公司的資產或清算價值（帳面價值）。</p>
                                    <div class="bg-slate-50 p-4 rounded-xl mb-4 font-mono text-sm text-slate-700"><strong>估價公式：</strong> 合理價 = BVPS (每股淨值) × 0.8</div>
                                    <p class="text-sm text-slate-500">💡 採用保守原則，打8折進場，保護投資者。</p>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <div class="flex items-center gap-2 mb-2"><div class="h-2 w-2 rounded-full bg-emerald-500"></div><h3 class="text-lg font-bold text-slate-800">2. 股息股 (Dividend Stock)</h3></div>
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 block ml-4">穩健成熟企業：公用事業、消費品</span>
                                <div class="ml-4">
                                    <p class="mb-4 text-slate-600">專注於穩定且持續成長的現金流回報。股息一年比一年高。</p>
                                    <div class="bg-slate-50 p-4 rounded-xl mb-4 font-mono text-sm text-slate-700"><strong>估價公式：</strong> 合理價 = 年度股息 ÷ 4%</div>
                                    <p class="text-sm text-slate-500">💡 搭配歷史殖利率區間，在相對高點買入。</p>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <div class="flex items-center gap-2 mb-2"><div class="h-2 w-2 rounded-full bg-emerald-500"></div><h3 class="text-lg font-bold text-slate-800">3. 成長股 (Growth Stock)</h3></div>
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 block ml-4">高成長企業：科技、生技、新興產業</span>
                                <div class="ml-4">
                                    <p class="mb-4 text-slate-600">專注於企業未來盈利能力的持續快速成長。EPS年年成長。</p>
                                    <div class="bg-slate-50 p-4 rounded-xl mb-4 font-mono text-sm text-slate-700"><strong>估價公式 (PEG法)：</strong> 合理價 = EPS × G (EPS成長率)</div>
                                    <p class="text-sm text-slate-500">💡 結合本益比與盈利成長性，彌補靜態P/E不足。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- KB: Moat -->
                    <div id="kb-content-moat" class="kb-content hidden space-y-6 fade-in">
                        <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-emerald-500 pl-4">經濟護城河 (Economic Moat)</h2>
                        <div class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100">
                            <strong class="text-emerald-800 block mb-2 text-lg">巴菲特將護城河形容為「深且危險的屏障」。</strong>
                            <p class="text-emerald-700">護城河的強度決定了未來現金流的確定性和成長的持久性，直接影響企業估值。只有具備可持續競爭優勢，企業才能賺取高於最低限度的利潤。</p>
                        </div>
                        <h3 class="text-xl font-bold text-slate-700">護城河的四大來源</h3>
                        <div class="grid sm:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-xl border border-slate-100 flex gap-4 items-start">
                                <div class="text-2xl bg-emerald-50 w-10 h-10 flex items-center justify-center rounded-lg shrink-0">🏷️</div>
                                <div><h4 class="font-bold text-slate-800 mb-1">無形資產</h4><p class="text-xs text-slate-500 leading-relaxed">來自於品牌、專利或特許經營權。強大品牌能創造顧客忠誠度。例：Coca-Cola</p></div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-100 flex gap-4 items-start">
                                <div class="text-2xl bg-emerald-50 w-10 h-10 flex items-center justify-center rounded-lg shrink-0">🔄</div>
                                <div><h4 class="font-bold text-slate-800 mb-1">轉換成本</h4><p class="text-xs text-slate-500 leading-relaxed">客戶更換產品代價高昂，從而鎖定客戶。例：Microsoft</p></div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-100 flex gap-4 items-start">
                                <div class="text-2xl bg-emerald-50 w-10 h-10 flex items-center justify-center rounded-lg shrink-0">🌐</div>
                                <div><h4 class="font-bold text-slate-800 mb-1">網絡效應</h4><p class="text-xs text-slate-500 leading-relaxed">產品價值隨著用戶數量增加而遞增，形成贏家通吃。例：VISA</p></div>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-100 flex gap-4 items-start">
                                <div class="text-2xl bg-emerald-50 w-10 h-10 flex items-center justify-center rounded-lg shrink-0">⚙️</div>
                                <div><h4 class="font-bold text-slate-800 mb-1">成本優勢</h4><p class="text-xs text-slate-500 leading-relaxed">來自規模經濟或獨特製程，能以低於競爭對手的成本運營。例：Walmart</p></div>
                            </div>
                        </div>
                    </div>

                    <!-- KB: Framework, DCF, Psychology content placeholders (structure same as above) -->
                    <!-- I will keep them minimal for brevity in this HTML file but fully functional -->
                    <div id="kb-content-framework" class="kb-content hidden space-y-6 fade-in">
                        <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-emerald-500 pl-4">完整投資決策框架</h2>
                        <div class="grid gap-4">
                            <div class="bg-white p-5 rounded-xl border border-slate-100 flex gap-4">
                                <div class="text-4xl font-bold text-slate-100 select-none">1</div>
                                <div><h4 class="font-bold text-slate-800 text-lg mb-1">理解圈 (Circle of Competence)</h4><p class="text-emerald-600 text-sm font-medium mb-2">這是我能理解的生意嗎？</p><ul class="text-xs text-slate-500 space-y-1"><li>• 清楚商業模式嗎？</li><li>• 了解產業特性嗎？</li></ul></div>
                            </div>
                            <!-- More steps... -->
                        </div>
                        <div class="bg-amber-50 p-6 rounded-2xl border border-amber-100 mt-6">
                            <h3 class="text-amber-800 font-bold text-lg mb-2">核心基石：安全邊際 (Margin of Safety)</h3>
                            <div class="bg-white bg-opacity-60 p-3 rounded-lg font-mono text-amber-900 mt-2">Upside = (合理價 - 股價) ÷ 股價 × 100%</div>
                            <p class="text-amber-600 text-sm mt-2">💡 標準：Upside > 50% 以上，就有足夠的安全邊際。</p>
                        </div>
                    </div>

                    <div id="kb-content-dcf" class="kb-content hidden space-y-6 fade-in">
                        <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-emerald-500 pl-4">絕對估值法：現金流量折現法 (DCF)</h2>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-3">基本原理公式</h3>
                            <div class="font-mono text-sm bg-slate-50 p-4 rounded-lg overflow-x-auto">內在價值 = ∑ [FCF / (1+r)^n] + 終值/(1+r)^n</div>
                        </div>
                        <div class="bg-rose-50 p-6 rounded-2xl border border-rose-100">
                            <h3 class="font-bold text-rose-800 mb-2">⚠️ 實務挑戰</h3>
                            <p class="text-rose-700 text-sm leading-relaxed">DCF高度依賴於對未來的假設。微小的假設變動都可能導致估值結果的巨大差異。</p>
                        </div>
                    </div>

                    <div id="kb-content-psychology" class="kb-content hidden space-y-6 fade-in">
                        <h2 class="text-2xl font-bold text-slate-800 border-l-4 border-emerald-500 pl-4">市場先生與投資心法</h2>
                        <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="text-xl font-bold text-slate-800 mb-4">🎩 市場先生 (Mr. Market) 寓言</h3>
                            <p class="font-medium text-emerald-700">市場是來服務你的，不是來指導你的。你應利用他的非理性，在他恐懼時買入，在他貪婪時保持謹慎。</p>
                        </div>
                        <div class="bg-slate-800 text-white p-8 rounded-2xl text-center">
                            <h3 class="text-xl font-bold mb-4">終極投資真理</h3>
                            <p class="text-slate-300 mb-4">「最好的投資是投資自己。」</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- 5. Concepts Gallery -->
        <div id="view-concepts" class="view-section hidden fade-in">
            <div class="space-y-8">
                <section>
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 pl-4 border-l-4 border-emerald-500">斯斯有三種，股票也有三種</h2>
                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Asset Card -->
                        <div class="rounded-2xl p-6 border-2 bg-blue-50 border-blue-200 hover:shadow-lg transition-shadow bg-white">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">🏦</div>
                                <div class="text-xs font-bold px-2 py-1 rounded-full bg-white/50 text-blue-800">標準：P/B < 0.8</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-blue-800">資產股 (Asset Plays)</h3>
                            <p class="text-slate-600 text-sm mb-4 min-h-[60px]">專注於公司的資產價值（如銀行、房地產、原物料）。當股價低於清算價值時買入。</p>
                            <div class="pt-4 border-t border-black/5"><span class="text-xs font-bold text-slate-400 uppercase">代表產業</span><p class="text-sm font-medium text-slate-700">銀行股, 營建股, 水泥股</p></div>
                        </div>
                        <!-- Dividend Card -->
                        <div class="rounded-2xl p-6 border-2 bg-amber-50 border-amber-200 hover:shadow-lg transition-shadow bg-white">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">💰</div>
                                <div class="text-xs font-bold px-2 py-1 rounded-full bg-white/50 text-amber-800">標準：殖利率 > 4%</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-amber-800">股息股 (Dividend Plays)</h3>
                            <p class="text-slate-600 text-sm mb-4 min-h-[60px]">業務成熟、現金流穩定。重點在於持續配息且股息成長。適合防禦型投資。</p>
                            <div class="pt-4 border-t border-black/5"><span class="text-xs font-bold text-slate-400 uppercase">代表產業</span><p class="text-sm font-medium text-slate-700">公用事業, 民生消費, 電信股</p></div>
                        </div>
                        <!-- Growth Card -->
                        <div class="rounded-2xl p-6 border-2 bg-rose-50 border-rose-200 hover:shadow-lg transition-shadow bg-white">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-4xl">🚀</div>
                                <div class="text-xs font-bold px-2 py-1 rounded-full bg-white/50 text-rose-800">標準：PEG < 1</div>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-rose-800">成長股 (Growth Plays)</h3>
                            <p class="text-slate-600 text-sm mb-4 min-h-[60px]">具備高速成長潛力。重點在於 EPS 年年成長。風險較高，但潛在報酬也最大。</p>
                            <div class="pt-4 border-t border-black/5"><span class="text-xs font-bold text-slate-400 uppercase">代表產業</span><p class="text-sm font-medium text-slate-700">科技股, 生技股, 新興產業</p></div>
                        </div>
                    </div>
                </section>

                <section class="bg-white rounded-2xl shadow-sm p-8 border border-slate-100">
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="flex-1">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">經濟護城河 (Economic Moat)</h2>
                            <p class="text-slate-600 leading-relaxed mb-6">
                                巴菲特：「護城河就像是保護企業高額利潤的屏障。」只有具備護城河的企業，才能長期維持高 ROE 與獲利能力，抵禦競爭對手的侵蝕。
                            </p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <!-- Moat items -->
                                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg"><i data-lucide="shield" class="text-emerald-600 mt-1"></i><div><h4 class="font-bold text-slate-800 text-sm">無形資產</h4><p class="text-xs text-slate-500">品牌、專利、特許執照</p></div></div>
                                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg"><i data-lucide="activity" class="text-emerald-600 mt-1"></i><div><h4 class="font-bold text-slate-800 text-sm">轉換成本</h4><p class="text-xs text-slate-500">客戶更換產品太麻煩</p></div></div>
                                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg"><i data-lucide="trending-up" class="text-emerald-600 mt-1"></i><div><h4 class="font-bold text-slate-800 text-sm">網絡效應</h4><p class="text-xs text-slate-500">用戶越多，價值越高</p></div></div>
                                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg"><i data-lucide="dollar-sign" class="text-emerald-600 mt-1"></i><div><h4 class="font-bold text-slate-800 text-sm">成本優勢</h4><p class="text-xs text-slate-500">規模經濟或獨特製程</p></div></div>
                            </div>
                        </div>
                        <div class="w-full md:w-1/3 flex justify-center">
                            <svg viewBox="0 0 200 200" class="w-64 h-64 drop-shadow-xl">
                                <circle cx="100" cy="100" r="90" fill="#e0f2fe" />
                                <circle cx="100" cy="100" r="60" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="2" />
                                <rect x="70" y="70" width="60" height="60" fill="#64748b" rx="4" />
                                <rect x="75" y="50" width="15" height="25" fill="#64748b" />
                                <rect x="110" y="50" width="15" height="25" fill="#64748b" />
                                <path d="M75 50 L82.5 35 L90 50 Z" fill="#ef4444" />
                                <path d="M110 50 L117.5 35 L125 50 Z" fill="#ef4444" />
                                <text x="100" y="160" text-anchor="middle" font-size="12" fill="#0369a1" font-weight="bold">高額利潤</text>
                            </svg>
                        </div>
                    </div>
                </section>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="mt-12 text-center text-slate-400 text-sm pb-4 border-t border-slate-200 pt-6">
        <p>© 2025 AI Software Design Master. All rights reserved.</p>
        <p class="text-xs mt-1">投資一定有風險，基金投資有賺有賠，申購前應詳閱公開說明書。本工具僅供輔助參考。</p>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        // --- State Management ---
        let stockType = 'asset';
        let checklistItems = [
            { id: 1, category: '獲利能力', text: 'EPS (每股盈餘) 過去 10 年穩定持續成長', passed: false },
            { id: 2, category: '現金流', text: '自由現金流 (Free Cash Flow) 過去 10 年皆為正數', passed: false },
            { id: 3, category: '經營效率', text: 'ROIC (投入資本回報率) 10 年每年大於 10%~15%', passed: false },
            { id: 4, category: '財務健康', text: '利息保障倍數 (Interest Coverage) 大於 4 (最好 >10 或無債)', passed: false },
            { id: 5, category: '獲利品質', text: '淨利率 (Net Margin) 大於 10% (最好 >20%)', passed: false },
            { id: 6, category: '股息政策', text: '股息 (Dividend) 10 年穩定發放且有成長', passed: false },
            { id: 7, category: '護城河', text: '具備持久競爭優勢 (品牌、轉換成本、網絡效應、成本優勢)', passed: false },
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            switchTab('home');
            updateStockTypeUI();
            renderChecklist();
        });

        // --- Fullscreen Logic ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const icon = document.getElementById('fullscreen-icon');
            if (document.fullscreenElement) {
                icon.setAttribute('data-lucide', 'minimize');
                document.getElementById('app-body').classList.add('p-4');
                document.getElementById('app-body').classList.remove('p-2', 'md:p-6');
            } else {
                icon.setAttribute('data-lucide', 'maximize');
                document.getElementById('app-body').classList.add('p-2', 'md:p-6');
                document.getElementById('app-body').classList.remove('p-4');
            }
            lucide.createIcons();
        });

        // --- Tab Navigation ---
        function switchTab(tabId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
            });
            // Show selected view
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            
            // Update nav button styles
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-emerald-600', 'text-white', 'shadow-emerald-200', 'ring-2', 'ring-emerald-100');
                btn.classList.add('bg-white', 'text-slate-600', 'hover:bg-emerald-50');
            });
            
            const activeBtn = document.getElementById(`btn-${tabId}`);
            activeBtn.classList.remove('bg-white', 'text-slate-600', 'hover:bg-emerald-50');
            activeBtn.classList.add('bg-emerald-600', 'text-white', 'shadow-emerald-200', 'ring-2', 'ring-emerald-100');
            
            // Re-initialize icons if necessary (sometimes needed for dynamic content)
            lucide.createIcons();
        }

        // --- Calculator Logic ---
        function setStockType(type) {
            stockType = type;
            updateStockTypeUI();
            
            // Hide result container when type changes
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('result-placeholder').classList.remove('hidden');
        }

        function updateStockTypeUI() {
            // Reset inputs logic visibility
            document.getElementById('input-group-asset').classList.add('hidden');
            document.getElementById('input-group-dividend').classList.add('hidden');
            document.getElementById('input-group-growth').classList.add('hidden');
            
            document.getElementById(`input-group-${stockType}`).classList.remove('hidden');

            // Update Type Button Styles
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('border-emerald-500', 'bg-emerald-50', 'text-emerald-700', 'font-bold', 'ring-1', 'ring-emerald-500');
                btn.classList.add('border-slate-200', 'text-slate-500', 'hover:bg-slate-50');
            });
            
            const activeBtn = document.getElementById(`type-${stockType}`);
            activeBtn.classList.remove('border-slate-200', 'text-slate-500', 'hover:bg-slate-50');
            activeBtn.classList.add('border-emerald-500', 'bg-emerald-50', 'text-emerald-700', 'font-bold', 'ring-1', 'ring-emerald-500');
        }

        function calculateValuation() {
            const price = parseFloat(document.getElementById('input-price').value);
            if (!price) return;

            let fairValue = 0;
            let formula = '';
            let tip = '';

            if (stockType === 'asset') {
                const bvps = parseFloat(document.getElementById('input-bvps').value);
                if (bvps) {
                    fairValue = bvps * 0.8;
                    formula = `每股淨值 (${bvps}) × 0.8 (安全折扣)`;
                    tip = "資產股重點在於清算價值。若股價低於每股淨值的 0.8 倍，通常提供了足夠的安全邊際。";
                }
            } else if (stockType === 'dividend') {
                const dividend = parseFloat(document.getElementById('input-dividend').value);
                if (dividend) {
                    fairValue = dividend / 0.04;
                    formula = `現金股利 (${dividend}) ÷ 4% (預期殖利率)`;
                    tip = "股息股重點在於現金流穩定性。請確認該公司是否連續10年穩定配息，且股息有成長趨勢。";
                }
            } else if (stockType === 'growth') {
                const eps = parseFloat(document.getElementById('input-eps').value);
                const g = parseFloat(document.getElementById('input-growth').value);
                if (eps && g) {
                    fairValue = eps * g;
                    formula = `EPS (${eps}) × 成長率 (${g})`;
                    tip = "成長股重點在於未來的成長率能否持續。請檢查 PEG 指標，並留意本益比是否過高 (>20需謹慎)。";
                }
            }

            if (fairValue > 0) {
                const mos = ((fairValue - price) / fairValue) * 100;
                const upside = ((fairValue - price) / price) * 100;
                const isUndervalued = price < fairValue;

                // Render Results
                document.getElementById('result-container').classList.remove('hidden');
                document.getElementById('result-placeholder').classList.add('hidden');

                document.getElementById('result-formula').textContent = formula;
                document.getElementById('result-fair-value').textContent = `$${fairValue.toFixed(2)}`;
                document.getElementById('result-tip').textContent = tip;
                
                const badge = document.getElementById('result-badge');
                if (isUndervalued) {
                    badge.textContent = '低估 (Undervalued)';
                    badge.className = 'px-3 py-1 rounded-full text-sm font-bold bg-emerald-100 text-emerald-700';
                } else {
                    badge.textContent = '高估 (Overvalued)';
                    badge.className = 'px-3 py-1 rounded-full text-sm font-bold bg-rose-100 text-rose-700';
                }

                // Update Bar Chart
                const maxScale = fairValue * 1.5;
                const percent = Math.min(Math.max((price / maxScale) * 100, 0), 100);
                document.getElementById('result-marker').style.left = `${percent}%`;
                document.getElementById('result-current-price-label').textContent = `目前股價 $${price}`;
                document.getElementById('result-max-scale').textContent = `$${maxScale.toFixed(0)}`;

                // Update Metrics
                const mosEl = document.getElementById('result-mos');
                mosEl.textContent = `${mos.toFixed(1)}%`;
                mosEl.className = `text-2xl font-bold ${mos > 0 ? 'text-emerald-600' : 'text-rose-500'}`;

                const upsideEl = document.getElementById('result-upside');
                upsideEl.textContent = `${upside.toFixed(1)}%`;
                upsideEl.className = `text-2xl font-bold ${upside > 0 ? 'text-emerald-600' : 'text-rose-500'}`;
            }
        }

        // --- Checklist Logic ---
        function toggleChecklistItem(id) {
            const item = checklistItems.find(i => i.id === id);
            if (item) {
                item.passed = !item.passed;
                renderChecklist();
            }
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-items');
            container.innerHTML = '';
            
            let passedCount = 0;

            checklistItems.forEach(item => {
                if (item.passed) passedCount++;
                
                const div = document.createElement('div');
                div.className = `flex items-center p-4 rounded-xl cursor-pointer border transition-all ${item.passed ? 'bg-emerald-50 border-emerald-200 shadow-sm' : 'bg-white border-slate-100 hover:bg-slate-50'}`;
                div.onclick = () => toggleChecklistItem(item.id);
                
                div.innerHTML = `
                    <div class="w-6 h-6 rounded-full flex items-center justify-center mr-4 shrink-0 transition-colors ${item.passed ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-400'}">
                        ${item.passed ? '<i data-lucide="check-circle" class="w-4 h-4"></i>' : ''}
                    </div>
                    <div class="flex-1">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">${item.category}</span>
                        <span class="font-medium ${item.passed ? 'text-slate-800' : 'text-slate-500'}">${item.text}</span>
                    </div>
                `;
                container.appendChild(div);
            });

            // Update Score
            const percentage = Math.round((passedCount / checklistItems.length) * 100);
            document.getElementById('score-number').textContent = passedCount;
            document.getElementById('score-circle').style.background = `conic-gradient(#10b981 ${percentage * 3.6}deg, #f1f5f9 0deg)`;
            
            // Update Rating Text
            let grade = '🧱 觀察名單';
            let desc = '基本面存在較多疑慮，建議保守觀望。';
            if (percentage >= 80) {
                grade = '💎 鑽石級好公司';
                desc = '符合巴菲特選股標準，具備強大護城河與財務體質。';
            } else if (percentage >= 50) {
                grade = '🥇 黃金級好公司';
                desc = '體質尚可，需注意未符合項目的潛在風險。';
            }
            
            document.getElementById('score-grade').textContent = grade;
            document.getElementById('score-desc').textContent = desc;

            lucide.createIcons();
        }

        // --- Knowledge Base Logic ---
        function switchKB(sectionId) {
            document.querySelectorAll('.kb-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`kb-content-${sectionId}`).classList.remove('hidden');
            
            document.querySelectorAll('.kb-nav-btn').forEach(btn => {
                btn.classList.remove('bg-emerald-50', 'text-emerald-700', 'font-bold');
                btn.classList.add('text-slate-600', 'hover:bg-slate-50');
            });
            
            const active = document.getElementById(`kb-nav-${sectionId}`);
            active.classList.remove('text-slate-600', 'hover:bg-slate-50');
            active.classList.add('bg-emerald-50', 'text-emerald-700', 'font-bold');
        }

    </script>
</body>
</html>